<!doctype html>
<head>
<title>Bootstrap Example</title>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<script src=./lib/jquery.min.js></script>
<link href=./lib/bootstrap.min.css>
<script src=./lib/bootstrap.bundle.min.js></script>
<style>*{margin:0;padding:0;box-sizing:border-box}#game{display:flex;position:fixed;top:0;bottom:0;left:0;right:0}#game #map-wrap{background-color:#322f5c;overflow:auto;height:100%;flex:1;padding:200px}#game #map-wrap #map{display:flex;flex-direction:column;margin:auto;flex:1;width:100%}#game #map-wrap #map .row{width:100%;flex:1;display:flex}#game #map-wrap #map .row .block{flex:1;border:2px solid #322f5c;display:flex;align-items:center;justify-content:center;position:relative;border-radius:16%}#game #map-wrap #map .row .block.empty{background-color:transparent}#game #map-wrap #map .row .block.visited{background-color:#818181!important}#game #map-wrap #map .row .block.inner-path{background-color:#7cff26!important}#game #map-wrap #map .row .block.end-path{box-shadow:#ff0 0 5px 35px;border:2px solid #ff0;z-index:2}#game #map-wrap #map .row .block.gate{position:relative}#game #map-wrap #map .row .block.gate>img{position:absolute;-o-object-fit:cover;object-fit:cover;z-index:2;border-radius:12%}#game #map-wrap #map .row .block .player{position:relative}#game #map-wrap #map .row .block .player img{-o-object-fit:cover;object-fit:cover;border:2px solid #10ff00}#game #map-wrap #map .row .block .player.active img{box-sizing:content-box;border:5px solid #ff0;box-shadow:#ff0 0 5px 35px}#game #game-info{width:400px;height:100%;padding:20px}#game #game-info>*{margin-bottom:40px}#game #game-info>*>.title{font-size:32px;color:#dc143c}#game #game-info #leaderboad .players .player{display:flex;width:240px}#game #game-info #leaderboad .players .player div:first-child{width:20px}#game #game-info #leaderboad .players .player div:nth-child(2){flex:1}#game #game-info #leaderboad .players .player div:last-child{width:20px}#game #game-info #dice .value{height:212px;width:212px;display:flex;flex-wrap:wrap;border-radius:44px;background-image:url(./resources/dice-bg.jpg);background-size:cover;padding:25px}#game #game-info #dice .value .node{height:53.9999px;width:53.9999px;padding:7px}#game #game-info #dice .value .node .circle{height:100%;background-color:#443f39;border-radius:50%;display:none;position:relative}#game #game-info #dice .value .node .circle::before{content:"";height:19.6px;width:12px;background-color:#5b5b5b;position:absolute;transform:rotate(45deg);border-radius:9px;bottom:6px;right:9px}#game #game-info #dice .value._1 .node._5 .circle{display:block}#game #game-info #dice .value._2 .node._3 .circle{display:block}#game #game-info #dice .value._2 .node._7 .circle{display:block}#game #game-info #dice .value._3 .node._3 .circle{display:block}#game #game-info #dice .value._3 .node._5 .circle{display:block}#game #game-info #dice .value._3 .node._7 .circle{display:block}#game #game-info #dice .value._4 .node._1 .circle{display:block}#game #game-info #dice .value._4 .node._3 .circle{display:block}#game #game-info #dice .value._4 .node._7 .circle{display:block}#game #game-info #dice .value._4 .node._9 .circle{display:block}#game #game-info #dice .value._5 .node._1 .circle{display:block}#game #game-info #dice .value._5 .node._3 .circle{display:block}#game #game-info #dice .value._5 .node._5 .circle{display:block}#game #game-info #dice .value._5 .node._7 .circle{display:block}#game #game-info #dice .value._5 .node._9 .circle{display:block}#game #game-info #dice .value._6 .node._1 .circle{display:block}#game #game-info #dice .value._6 .node._3 .circle{display:block}#game #game-info #dice .value._6 .node._4 .circle{display:block}#game #game-info #dice .value._6 .node._6 .circle{display:block}#game #game-info #dice .value._6 .node._7 .circle{display:block}#game #game-info #dice .value._6 .node._9 .circle{display:block}#game #game-info #dice button{margin-top:8px;cursor:pointer;font-size:24px;padding:8px 20px;background-color:#0ff}#question{position:fixed;left:0;right:0;bottom:-100%;background-color:#fff;height:100%;padding:40px;box-shadow:0 1px 48px #8d8d8d;z-index:3;display:flex}#question .card{height:100%}#question .card img{height:100%}#question .content{flex:1;margin-left:40px;display:flex;flex-direction:column;align-items:center}#question .content .score-info{font-size:40px;font-weight:600}#question .content .player{width:100%;display:flex;flex-direction:column;align-items:center;margin-top:40px;margin-bottom:80px}#question .content .player .avatar{width:30%;aspect-ratio:1;-o-object-fit:cover;object-fit:cover;border-radius:50%}#question .content .player .name{margin-top:18px;font-size:24px}#question .content .control{width:100%;display:flex;justify-content:space-evenly}#question .content .control button{font-size:25px;min-width:180px;padding:10px;cursor:pointer}#question .content .control button.true{background-color:#7cff26}#question .content .control button.false{background-color:red}#special-card-warp{position:fixed;top:0;right:0;bottom:0;left:0;opacity:0;background-color:rgba(0,0,0,.6)}#special-card-warp .card{position:absolute;top:10%;height:80%;left:50%;transform:translateX(-50%);display:flex;flex-direction:column;align-items:center}#special-card-warp .card .title{color:#fff;font-size:60px;margin-bottom:18px}#special-card-warp .card img{height:75%}</style>
</head>
<body>
<script>window.addEventListener("resize",function e(){let t=[[800,.6],[1200,.7],[1536,.8],[1920,1],[2560,4/3],[3400,1.7]],n=t.length;t.sort(((e,t)=>e[0]-t[0]));let i=t[0][0],d=t[n-1][0],o=window.innerWidth||document.clientWidth||document.body?.clientWidth||1536,l=1;if(o<=i)l=t[0][1];else if(d<o)l=t[n-1][1];else for(let e=0;e<n-1;e++)t[e][0]<o&&(l=t[e][1]+(t[e+1][1]-t[e][1])*(o-t[e][0])/(t[e+1][0]-t[e][0]));return document.body.style.zoom=l,e}())</script>
<div id=game>
<div id=map-wrap>
<div id=map></div>
</div>
<div id=game-info>
<div id=leaderboad>
<div class=title>Bảng xếp hạng</div>
<div class=players></div>
</div>
<div id=order>
</div>
<div id=dice>
<div class=title>Xúc xắc</div>
<div class="value _1">
<div class="_1 node"><div class=circle></div></div>
<div class="_2 node"><div class=circle></div></div>
<div class="_3 node"><div class=circle></div></div>
<div class="_4 node"><div class=circle></div></div>
<div class="_5 node"><div class=circle></div></div>
<div class="_6 node"><div class=circle></div></div>
<div class="_7 node"><div class=circle></div></div>
<div class="_8 node"><div class=circle></div></div>
<div class="_9 node"><div class=circle></div></div>
</div>
<button>Quay</button>
</div>
</div>
</div>
<script>!function(){let e=60,t=[2,2],a=(()=>{let e=0;return()=>Math.abs(Math.sin(e++))})(),r=(e,t)=>e+Math.floor(a()*(t+1-e)),s={map:["g----g----g----g","b----p----p----b","p----pbbpbp----b","b----b----p----p","p----b----b----b","p----p----b----p","bpbpbp----ppbybb","p----b----b----p","y----pbpbpy----p","p----b----b----b","b----y----pbpbpb","p----p----b----p","bppbpb----b----y","p----bppbbp----p","p----b----p----b","b----p----b----b","ppypbb----pbpbbp","b----p----b----b","b----pbbpbp----p","p----b----b----b","p----y----b----p","y----b----p----y","p----p----y----p","p----p----p----p"],players:[{start:[0,0],name:"Phạm Trường Lan Thy",avatarUrl:"./resources/pham-truong-lan-thy.jpg"},{start:[0,5],name:"Huấn Hoa Hồng",avatarUrl:"./resources/huan-hoa-hong.jpg"},{start:[0,10],name:"Sơn Tùng MTP",avatarUrl:"./resources/son-tung-mtp.jpg"},{start:[0,15],name:"Trần Dần",avatarUrl:"./resources/tran-dan.jpg"}],places:{"6-13":{url:"./resources/ho-guom.jpg"},"8-0":{url:"./resources/ho-guom.jpg"},"8-10":{url:"./resources/ho-guom.jpg"},"10-5":{url:"./resources/ho-guom.jpg"},"12-15":{url:"./resources/ho-guom.jpg"},"16-2":{url:"./resources/ho-guom.jpg"},"20-5":{url:"./resources/ho-guom.jpg"},"21-0":{url:"./resources/ho-guom.jpg"},"21-15":{url:"./resources/ho-guom.jpg"},"22-10":{url:"./resources/ho-guom.jpg"}}};s.boardSize=[s.map.length,s.map[0].length],function(a){let n=$("#map").html("").css({height:a.length*e+"px",width:a[0].length*e+"px"});for(let l=0;l<a.length;l++){let i=$('<div class="row"></div>');for(let p=0;p<a[l].length;p++){let c=a[l][p],u=$('<div class="block"></div>');if(i.append(u),"-"==c)u.addClass("empty");else if("y"==c){u.css({"background-color":"#fad688"}),u.addClass("gate"),u.attr("isGate",!0);let d=t,h=.25;function o(e,t,r){function s(e,t){return!!a?.[e]?.[t]&&"-"!=a[e][t]}if("t"==r){for(let a=l-1;a>=l-1-Math.ceil(e-h);a--)for(let e=p-Math.ceil(t/2-.5);e<=p+Math.ceil(t/2-.5);e++)if(s(a,e))return!0}else if("b"==r){for(let a=l+1;a<=l+1+Math.ceil(e-h);a++)for(let e=p-Math.ceil(t/2-.5);e<=p+Math.ceil(t/2-.5);e++)if(s(a,e))return!0}else if("l"==r){for(let a=l-Math.ceil(e/2-.5);a<=l+Math.ceil(e/2-.5);a++)for(let e=p-1;e>=p-1-Math.ceil(t-h);e--)if(s(a,e))return!0}else if("r"==r)for(let a=l-Math.ceil(e/2-.5);a<=l+Math.ceil(e/2-.5);a++)for(let e=p+1;e<=p+1+Math.ceil(t-h);e++)if(s(a,e))return!0;return!1}let b=["l","t","b","r"].find((e=>!o(d[0],d[1],e))),m=$(`<img src="${s.places[l+"-"+p].url}"/>`).css({height:d[0]*e+"px",width:d[1]*e+"px"}).css({l:{right:100*(1+h)+"%"},t:{bottom:100*(1+h)+"%"},b:{top:100*(1+h)+"%"},r:{left:100*(1+h)+"%"}}[b]);u.append(m)}else"g"==c?u.css({"background-color":"#818181"}):"p"==c?(u.css({"background-color":"#e99ebc"}),u[0].blockInfo={score:2,question:`./resources/card-tinh-huong/${r(0,14)}.png`}):"b"==c&&(u.css({"background-color":"#bad7fc"}),u[0].blockInfo={score:1,question:`./resources/card-thu-thach/${r(0,14)}.png`})}n.append(i)}}(s.map);let n=(e,t)=>$($($("#map > *")[e]).find(".block")[t]),o=([e,t],a,r=[])=>{let n=[];return function e([t,a],o,l){if(0==l)return void n.push([...o]);[[t+1,a],[t-1,a],[t,a+1],[t,a-1]].forEach((([t,a])=>{t<0||a<0||t>s.boardSize[0]-1||a>s.boardSize[1]-1||"-"!=s.map[t][a]&&(o.some((([e,r])=>t==e&&a==r))||r.some((([e,r])=>t==e&&a==r))||(o.push([t,a]),e([t,a],o,l-1),o.pop()))}))}([e,t],[[e,t]],a),n},l=(t,a,r)=>{a=[...a];let s=new Set,n=0;for(let e=1;e<a.length-1;e++)a[n][0]==a[e][0]&&a[e][0]==a[e+1][0]||a[n][1]==a[e][1]&&a[e][1]==a[e+1][1]?s.add(e):n=e;a=a.filter(((e,t)=>!s.has(t)));let o=t.$player.css("z-index",3);!function s(n){let[l,i]=a[n-1],[p,c]=a[n];o.animate({bottom:l-p==0?"+=0px":l-p>0?`-=${(p-l)*e}px`:`+=${(l-p)*e}px`,right:i-c==0?"+=0px":i-c>0?`-=${(c-i)*e}px`:`+=${(i-c)*e}px`},250*(Math.abs(p-l)+Math.abs(c-i)),(()=>{if(n==a.length-1){o.css({bottom:0,right:0,"z-index":"unset"}),t.moveTo(a[n]);let s=o.parent();return s.find(".player").length>1?s.css("width",e+"px"):s.css("width","unset"),void r()}setTimeout((()=>s(n+1)),10)}))}(1)};class i{constructor({start:e,name:t,avatarUrl:a,id:r}){this.id=r,this.currPos=[...e],this.name=t,this.score=0,this.$player=null,this.avatarUrl=a||"./resources/default.jpg"}initView(){this.$player=$(`<div class="player" id="${this.id}">\n            <img src="${this.avatarUrl}"\n                style = "\n                    width: ${.6*e}px;\n                    aspect-ratio: 1;\n                    border-radius: 50%;\n                "\n            />\n        </div>`),n(this.currPos[0],this.currPos[1]).append(this.$player)}moveTo([e,t]){this.currPos=[e,t],n(e,t).append(this.$player)}}function p(e){(e=[...e]).sort(((e,t)=>t.score-e.score)),$("#leaderboad .players").html("").append(e.map(((e,t)=>`<div class="player">\n                <div>${t+1}</div>\n                <div>${e.name}</div>\n                <div>${e.score}</div>\n            </div>`)))}function c(e,t,a){let r=$(`<div id="special-card-warp">\n        <div class="card">\n            <div class="title">${e}</div>\n            <img src="${t}">\n        </div>\n    </div>`);$(document.body).append(r),r.animate({opacity:1},300,(()=>{r.click((function(){let e=$(this);e.animate({opacity:0},300,(()=>{e.remove(),a()}))}))}))}s.players=s.players.map(((e,t)=>(e.name=e.name||`Người chơi ${t+1}`,e.id="id"+t,new i(e)))),s.players.forEach((e=>e.initView())),p(s.players),function(){let e=0;!function t(){let a=s.players[e++];e%=s.players.length,a.$player.addClass("active"),$("#dice button").click((()=>{$("#dice button").remove();let e=1,i=$("#dice .value"),u=setInterval((()=>{let t=e;for(;t==e;)t=Math.floor(6*Math.random())+1;i.removeClass("_"+e).addClass("_"+t),e=t}),30);setTimeout((()=>clearInterval(u)),2e3),setTimeout((()=>{let e=parseInt($("#dice .value").attr("class").replace("value _","")),i=s.players.map((e=>e.currPos)),u=o(a.currPos,e,i);0==u.length&&(a.$player.removeClass("active"),$("#dice").append("<button>Quay</button>"),setTimeout((()=>t()),10));let d={};u.forEach((e=>d[e[e.length-1].join("-")]=e));let h=[...new Set(u.map((e=>e[e.length-1].join("-"))))].map((e=>e.split("-"))),b=new Set;u.forEach((e=>{for(let t=0;t<e.length-1;t++)b.add(e[t].join("-"))})),u.forEach((e=>{b.delete(e[e.length-1].join("-"))}));let m=[...b].map((e=>e.split("-")));m.forEach((([e,t])=>{n(e,t).addClass("inner-path")})),h.forEach((([e,o])=>{n(e,o).addClass("end-path").click((function(){h.forEach((([e,t])=>{n(e,t).off("click")})),l(a,d[e+"-"+o],(()=>{m.forEach((([e,t])=>{n(e,t).removeClass("inner-path")})),h.forEach((([e,t])=>{n(e,t).removeClass("end-path")}));let l=n(e,o),i=l[0].blockInfo;function u(){l[0].blockInfo=null,l.attr("isGate")||l.addClass("visited"),a.$player.removeClass("active"),$("#dice").append("<button>Quay</button>"),setTimeout((()=>t()),10)}i&&!i.visited?function(e,t,a,s,n){let o=$(`<div id="question">\n        <div class="card">\n            <img src="${e}">\n        </div>\n        <div class="content">\n            <div class="score-info">Câu hỏi ${t} điểm</div>\n            <div class="player">\n                <img src="${a.avatarUrl}" class="avatar">\n                <div class="name">${a.name}</div>\n            </div>\n            <div class="control">\n                <button class="true">Chính xác</button>\n                <button class="false">Sai</button>\n            </div>\n        </div>\n    </div>`);$(document.body).append(o),o.animate({bottom:"0"}),o.find("button.true").click((()=>{o.animate({top:"100%"},200,(()=>{c("Thẻ thưởng",`./resources/card-thuong/${r(0,9)}.png`,(()=>s())),o.remove()}))})),o.find("button.false").click((()=>{o.animate({top:"100%"},350,(()=>{c("Thẻ phạt",`./resources/card-phat/${r(0,9)}.png`,(()=>n())),o.remove()}))}))}(i.question,i.score,a,(function(){a.score+=i.score,p(s.players),u()}),(function(){p(s.players),u()})):u()}))}))}))}),2010)}))}()}()}()</script>
</body>
