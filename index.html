<!doctype html>
<head>
<title>Bootstrap Example</title>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<script src=./lib/jquery.min.js></script>
<link href=./lib/bootstrap.min.css>
<script src=./lib/bootstrap.bundle.min.js></script>
<style>*{margin:0;padding:0;box-sizing:border-box}#game{display:flex;height:100vh}#game #map-wrap{background-color:#322f5c;overflow:auto;height:100%;flex:1;padding:200px}#game #map-wrap #map{display:flex;flex-direction:column;margin:auto;flex:1;width:100%}#game #map-wrap #map .row{width:100%;flex:1;display:flex}#game #map-wrap #map .row .block{flex:1;border:2px solid #322f5c;display:flex;align-items:center;justify-content:center;position:relative}#game #map-wrap #map .row .block.empty{background-color:transparent}#game #map-wrap #map .row .block.visited{background-color:#818181!important}#game #map-wrap #map .row .block.inner-path{background-color:#7cff26!important}#game #map-wrap #map .row .block.end-path{box-shadow:#ff0 0 5px 35px;border:2px solid #ff0;z-index:2}#game #map-wrap #map .row .block.gate{position:relative}#game #map-wrap #map .row .block.gate>img{position:absolute;-o-object-fit:cover;object-fit:cover;z-index:2}#game #map-wrap #map .row .block .player{position:relative}#game #map-wrap #map .row .block .player img{-o-object-fit:cover;object-fit:cover;border:2px solid #10ff00}#game #map-wrap #map .row .block .player.active img{box-sizing:content-box;border:5px solid #ff0;box-shadow:#ff0 0 5px 35px}#game #game-info{width:400px;height:100%;padding:20px}#game #game-info>*{margin-bottom:40px}#game #game-info>*>.title{font-size:32px;color:#dc143c}#game #game-info #leaderboad .players .player{display:flex;width:240px}#game #game-info #leaderboad .players .player div:first-child{width:20px}#game #game-info #leaderboad .players .player div:nth-child(2){flex:1}#game #game-info #leaderboad .players .player div:last-child{width:20px}#game #game-info #dice .value{font-size:60px;font-weight:600;height:120px;width:120px;display:flex;justify-content:center;align-items:center;border:5px solid}#game #game-info #dice button{margin-top:8px;cursor:pointer;font-size:24px;padding:8px 20px;background-color:#0ff}#question{position:fixed;left:0;right:0;background-color:#fff;padding:40px;box-shadow:0 1px 48px #8d8d8d;z-index:3}#question .header{display:flex}#question .header .content{flex:1}#question .header .player{display:flex;flex-direction:column;align-items:center}#question .header .player .avatar{aspect-ratio:1;width:160px;border-radius:50%;-o-object-fit:cover;object-fit:cover}#question .header .player .name{margin-top:8px;font-size:20px}#question .control{padding:20px;display:flex;justify-content:space-evenly}#question .control button{font-size:25px;min-width:180px;padding:10px;cursor:pointer}#question .control button.true{background-color:#7cff26}#question .control button.false{background-color:red}</style>
</head>
<body>
<div id=game>
<div id=map-wrap>
<div id=map></div>
</div>
<div id=game-info>
<div id=leaderboad>
<div class=title>Bảng xếp hạng</div>
<div class=players></div>
</div>
<div id=order>
</div>
<div id=dice>
<div class=title>Xúc xắc</div>
<div class=value>1</div>
<button>Quay</button>
</div>
</div>
</div>
<script>!function(){let e=60,t=[2,2],a=(()=>{let e=0;return()=>Math.abs(Math.sin(e++))})(),r=(e,t)=>e+Math.floor(a()*(t+1-e)),s={map:["g----g----g----g","b----p----p----b","p----pbbpbp----b","b----b----p----p","p----b----b----b","p----p----b----p","bpbpbp----ppbybb","p----b----b----p","y----pbpbpy----p","p----b----b----b","b----y----pbpbpb","p----p----b----p","bppbpb----b----y","p----bppbbp----p","p----b----p----b","b----p----b----b","ppypbb----pbpbbp","b----p----b----b","b----pbbpbp----p","p----b----b----b","p----y----b----p","y----b----p----y","p----p----y----p","p----p----p----p"],players:[{start:[0,0],name:"Phạm Trường Lan Thy",avatarUrl:"./resources/pham-truong-lan-thy.jpg"},{start:[0,5],name:"Huấn Hoa Hồng",avatarUrl:"./resources/huan-hoa-hong.jpg"},{start:[0,10],name:"Sơn Tùng MTP",avatarUrl:"./resources/son-tung-mtp.jpg"},{start:[0,15],name:"Trần Dần",avatarUrl:"./resources/tran-dan.jpg"}],places:{"6-13":{url:"./resources/ho-guom.jpg"},"8-0":{url:"./resources/ho-guom.jpg"},"8-10":{url:"./resources/ho-guom.jpg"},"10-5":{url:"./resources/ho-guom.jpg"},"12-15":{url:"./resources/ho-guom.jpg"},"16-2":{url:"./resources/ho-guom.jpg"},"20-5":{url:"./resources/ho-guom.jpg"},"21-0":{url:"./resources/ho-guom.jpg"},"21-15":{url:"./resources/ho-guom.jpg"},"22-10":{url:"./resources/ho-guom.jpg"}}};s.boardSize=[s.map.length,s.map[0].length],function(a){let n=$("#map").html("").css({height:a.length*e+"px",width:a[0].length*e+"px"});for(let l=0;l<a.length;l++){let i=$('<div class="row"></div>');for(let p=0;p<a[l].length;p++){let c=a[l][p],u=$('<div class="block"></div>');if(i.append(u),"-"==c)u.addClass("empty");else if("y"==c){u.css({"background-color":"#fad688"}),u.addClass("gate"),u.attr("isGate",!0);let h=t,d=.25;function o(e,t,r){function s(e,t){return!!a?.[e]?.[t]&&"-"!=a[e][t]}if("t"==r){for(let a=l-1;a>=l-1-Math.ceil(e-d);a--)for(let e=p-Math.ceil(t/2-.5);e<=p+Math.ceil(t/2-.5);e++)if(s(a,e))return!0}else if("b"==r){for(let a=l+1;a<=l+1+Math.ceil(e-d);a++)for(let e=p-Math.ceil(t/2-.5);e<=p+Math.ceil(t/2-.5);e++)if(s(a,e))return!0}else if("l"==r){for(let a=l-Math.ceil(e/2-.5);a<=l+Math.ceil(e/2-.5);a++)for(let e=p-1;e>=p-1-Math.ceil(t-d);e--)if(s(a,e))return!0}else if("r"==r)for(let a=l-Math.ceil(e/2-.5);a<=l+Math.ceil(e/2-.5);a++)for(let e=p+1;e<=p+1+Math.ceil(t-d);e++)if(s(a,e))return!0;return!1}let b=["l","t","b","r"].find((e=>!o(h[0],h[1],e))),f=$(`<img src="${s.places[l+"-"+p].url}"/>`).css({height:h[0]*e+"px",width:h[1]*e+"px"}).css({l:{right:100*(1+d)+"%"},t:{bottom:100*(1+d)+"%"},b:{top:100*(1+d)+"%"},r:{left:100*(1+d)+"%"}}[b]);u.append(f)}else if("g"==c)u.css({"background-color":"#818181"});else{let m={p:"#e99ebc",b:"#bad7fc"},g={p:2,b:1};u.css({"background-color":m[c]}),u[0].blockInfo={score:g[c],question:"b"==c?`${r(100,300)} ${["+","-","*"][r(0,2)]} ${r(100,300)} = ?`:`${r(1e4,3e4)} ${["+","-","*"][r(0,2)]} ${r(1e4,3e4)} = ?`}}}n.append(i)}}(s.map);let n=(e,t)=>$($($("#map > *")[e]).find(".block")[t]),o=([e,t],a)=>{let r=[];return function e([t,a],n,o){if(0==o)return void r.push([...n]);[[t+1,a],[t-1,a],[t,a+1],[t,a-1]].forEach((([t,a])=>{t<0||a<0||t>s.boardSize[0]-1||a>s.boardSize[1]-1||"-"!=s.map[t][a]&&(n.some((([e,r])=>t==e&&a==r))||(n.push([t,a]),e([t,a],n,o-1),n.pop()))}))}([e,t],[[e,t]],a),r},l=(t,a,r)=>{a=[...a];let s=new Set,n=0;for(let e=1;e<a.length-1;e++)a[n][0]==a[e][0]&&a[e][0]==a[e+1][0]||a[n][1]==a[e][1]&&a[e][1]==a[e+1][1]?s.add(e):n=e;a=a.filter(((e,t)=>!s.has(t)));let o=t.$player.css("z-index",3);!function s(n){let[l,i]=a[n-1],[p,c]=a[n];o.animate({bottom:l-p==0?"+=0px":l-p>0?`-=${(p-l)*e}px`:`+=${(l-p)*e}px`,right:i-c==0?"+=0px":i-c>0?`-=${(c-i)*e}px`:`+=${(i-c)*e}px`},250*(Math.abs(p-l)+Math.abs(c-i)),(()=>{if(n==a.length-1){o.css({bottom:0,right:0,"z-index":"unset"}),t.moveTo(a[n]);let s=o.parent();return s.find(".player").length>1?s.css("width",e+"px"):s.css("width","unset"),void r()}setTimeout((()=>s(n+1)),10)}))}(1)};class i{constructor({start:e,name:t,avatarUrl:a,id:r}){this.id=r,this.currPos=[...e],this.name=t,this.score=0,this.$player=null,this.avatarUrl=a||"./resources/default.jpg"}initView(){this.$player=$(`<div class="player" id="${this.id}">\n            <img src="${this.avatarUrl}"\n                style = "\n                    width: ${.6*e}px;\n                    aspect-ratio: 1;\n                    border-radius: 50%;\n                "\n            />\n        </div>`),n(this.currPos[0],this.currPos[1]).append(this.$player)}moveTo([e,t]){this.currPos=[e,t],n(e,t).append(this.$player)}}function p(e){(e=[...e]).sort(((e,t)=>t.score-e.score)),$("#leaderboad .players").html("").append(e.map(((e,t)=>`<div class="player">\n                <div>${t+1}</div>\n                <div>${e.name}</div>\n                <div>${e.score}</div>\n            </div>`)))}s.players=s.players.map(((e,t)=>(e.name=e.name||`Người chơi ${t+1}`,e.id="id"+t,new i(e)))),s.players.forEach((e=>e.initView())),p(s.players),function(){let e=0;!function t(){let a=s.players[e++];e%=s.players.length,a.$player.addClass("active"),$("#dice button").click((()=>{$("#dice button").remove();let e=0,r=setInterval((()=>$("#dice .value").html((()=>{let t=e;for(;t==e;)t=Math.round(12*Math.random())+1;return e=t,t})())),30);setTimeout((()=>clearInterval(r)),2e3),setTimeout((()=>{let e=parseInt($("#dice .value").html()),r=o(a.currPos,e),i={};r.forEach((e=>i[e[e.length-1].join("-")]=e));let c=[...new Set(r.map((e=>e[e.length-1].join("-"))))].map((e=>e.split("-"))),u=new Set;r.forEach((e=>{for(let t=0;t<e.length-1;t++)u.add(e[t].join("-"))})),r.forEach((e=>{u.delete(e[e.length-1].join("-"))}));let h=[...u].map((e=>e.split("-")));h.forEach((([e,t])=>{n(e,t).addClass("inner-path")})),c.forEach((([e,r])=>{n(e,r).addClass("end-path").click((function(){c.forEach((([e,t])=>{n(e,t).off("click")})),l(a,i[e+"-"+r],(()=>{h.forEach((([e,t])=>{n(e,t).removeClass("inner-path")})),c.forEach((([e,t])=>{n(e,t).removeClass("end-path")}));let o=n(e,r),l=o[0].blockInfo;function i(){o[0].blockInfo=null,o.attr("isGate")||o.addClass("visited"),a.$player.removeClass("active"),$("#dice").append("<button>Quay</button>"),setTimeout((()=>t()),10)}l&&!l.visited?function(e,t,a,r,s){let n=$(`<div id="question">\n        <div class="header">\n            <div class="content">\n                <h3>Câu hỏi ${t} điểm</h3>\n                <h1>${e}</h1>\n            </div>\n            <div class="player">\n                <img src="${a.avatarUrl}" class="avatar">\n                <div class="name">${a.name}</div>\n            </div>\n        </div>\n        <div class="control">\n            <button class="true">Chính xác</button>\n            <button class="false">Sai</button>\n        </div>\n    </div>`);$(document.body).append(n),n.animate({bottom:"0"}),n.find("button.true").click((()=>{n.animate({top:"100%"},200,(()=>{r(),n.remove()}))})),n.find("button.false").click((()=>{n.animate({top:"100%"},350,(()=>{s(),n.remove()}))}))}(l.question,l.score,a,(function(){a.score+=l.score,p(s.players),i()}),(function(){i()})):i()}))}))}))}),2010)}))}()}()}()</script>
</body>
